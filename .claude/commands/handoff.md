---
name: handoff
description: Написать или обновить документ передачи контекста для следующего агента.
---

Пользователь работал над задачей — возможно долго. Сейчас он хочет зафиксировать состояние: что было сделано, где остановились, что важно не потерять. Этот документ будет точкой входа, когда он (или другой агент) вернётся к задаче — может через час, а может через неделю, когда уже ничего не помнится.

Твоя задача — оглядеться по текущему чату и проекту, вспомнить цель, оценить прогресс и собрать хороший снэпшот. Документ должен позволить гладко продолжить работу: и новому агенту с чистым контекстом, и самому пользователю после перерыва, когда всё забылось и тяжело начать.

## Шаг 0: Определи, куда писать

Есть два варианта:

### Вариант A: `HANDOFF.md` в корне проекта
Используй, когда:
- Работа идёт над проектом в целом (одна задача, нет иерархии)
- Нет отдельной папки/контекста для конкретной задачи
- Задача одна и она "про весь проект"

### Вариант B: `status.md` в папке задачи
Используй, когда:
- В проекте несколько параллельных задач, каждая со своей папкой или контекстом
- Работа ведётся над конкретной задачей внутри иерархии (например, `tasks/aia-765/`, `features/billing/`, `docs/migration/`, `proposals/auth/`)
- У задачи уже есть своя папка с документацией

В этом случае пиши в `status.md` внутри папки задачи (например, `tasks/aia-765/status.md`), а **не** в HANDOFF.md на уровне проекта. Это позволяет каждой задаче иметь свой независимый контекст передачи.

**Как определить:** посмотри, над чем мы работали в этом чате. Если работа была сфокусирована на конкретной папке/задаче и в проекте есть (или подразумевается) несколько таких задач — выбирай Вариант B. Если сомневаешься — спроси пользователя.

---

## Шаги

1. Определи целевой файл (Вариант A или B, см. выше)
2. Проверь, существует ли этот файл
3. Если существует — сначала прочитай его, чтобы понять предыдущий контекст
4. Определи, есть ли в проекте сопровождающие документы, над которыми мы работали в этом чате (спецификации, ТЗ, описания и т.д.)
5. Создай или обнови документ со следующими разделами:

   - **Single Grasp** *(всегда первая секция в документе)*: Короткий блок, который позволяет за 30 секунд вспомнить, что происходит. Написан для ситуации: «прошла неделя, я не помню вообще ничего, у меня прокрастинация, мне тяжело начать». Формат — 3–5 предложений, живым языком, без бюрократии. Должен ответить на три вопроса: (1) что мы делаем и зачем, (2) на чём конкретно остановились, (3) какой один следующий шаг, чтобы прямо сейчас сесть и продолжить. Цель — убрать барьер входа и дать ощущение «а, точно, я помню, погнали».
   - **Контекст**: Глобальный контекст задачи — зачем всё это, кто заказчик, какую проблему решаем для пользователя/бизнеса, чего хотим в итоге. Эта секция меняется редко — она про «большую картину», а не про текущий спринт. При обновлении handoff-а: если контекст уже написан и ничего принципиально не изменилось — оставь как есть или подправь минимально.
   - **Цель**: Что конкретно мы делаем в рамках этой задачи (в отличие от Контекста — это про конкретную техническую цель, а не про «зачем»)
   - **Рабочие файлы**: Список файлов, над которыми велась работа в этом чате. Если основной контекст зафиксирован в самих файлах (спецификация, ТЗ и т.д.) — НЕ дублируй их содержимое. Достаточно указать путь к файлу и кратко — что именно в нём делалось/менялось.
   - **Ход пьесы и текущий прогресс**: Ёмко, но детально — что мы делали, какие building blocks построили, через какие этапы прошли, и где мы прямо сейчас. Это нарратив работы, а не список фактов. По мере роста документа предыдущие шаги можно группировать/сворачивать (например, «Этапы 1–3: настроили инфру и базовый пайплайн»), чтобы документ не раздувался, но свежие шаги описывай подробно.
   - **Что сработало**: Только конкретные удачные решения и подходы, которые стоит переиспользовать. Не история — а выжимка: «сделали X, и это оказалось правильным ходом, потому что Y».
   - **Что не сработало**: Только конкретные ошибки и тупики, чтобы их не повторяли. Формат тот же — выжимка: «пробовали X, не сработало, потому что Y».
   - **Важные детали и заметки**: Кастомные детали, которые легко потерять при смене контекста. Примеры: доступы и ограничения окружения ("доступ к куберу только в кластер home-n1"), рабочие команды и сниппеты ("деплой через `make deploy-staging`"), особенности инфраструктуры, нюансы конфигурации, любые ad-hoc замечания пользователя, которые не зафиксированы в основных документах. Эта секция растёт со временем — это нормально.
   - **Следующие шаги**: Чёткие action items для продолжения работы

6. **Обнови руководящие документы**, если они есть. Речь НЕ про все файлы, которые редактировались — только про документы с «руководящим контекстом»: план задачи, описание фичи, changelog, task_plan и подобные. Это документы, которые направляют работу и должны отражать актуальное состояние. Прочитай их и обнови в соответствии с тем, что произошло в этом чате. Если таких документов нашлось больше 3 — уточни у пользователя, какие именно нужно обновить.

## Важно

- Не раздувай документ — он должен быть компактным и полезным
- Если контекст уже зафиксирован в рабочих файлах, ссылайся на них, а не копируй содержимое
- Для Варианта B: если в папке задачи уже есть `status.md` с другой структурой — адаптируйся к ней, не ломай существующий формат

Сохрани файл и сообщи пользователю путь к нему, чтобы он мог начать новый чат с этим файлом.